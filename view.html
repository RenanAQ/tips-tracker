<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Payments</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Payment Records</h1>
      <div class="actions" style="margin-top:10px;">
        <a class="btn" href="index.html">+ Add Payment</a>
        <span class="status" id="status"></span>
      </div>

      <table>
        <thead>
          <tr>
            <th style="width: 160px;">Date</th>
            <th>Name</th>
            <th style="width: 160px;">Paid Value</th>
          </tr>
        </thead>
        <tbody id="paymentsTable"></tbody>
      </table>
    </div>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzuvqY3e_Fl3L-zMXRjK5wOPsAeg88P8MQC5YXO1qqeegYrAoMGrCFp-fZFi1vGZhKO/exec";

    const table = document.getElementById("paymentsTable");
    const statusEl = document.getElementById("status");

    function money(v) {
      const n = Number(v);
      return Number.isFinite(n) ? `$${n.toFixed(2)}` : (v ?? "");
    }

    function renderData(data) {
      if (!data.ok) {
        statusEl.textContent = "Failed to load.";
        return;
      }

      table.innerHTML = "";
      data.rows.forEach(r => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${r.date ?? ""}</td>
          <td>${r.name ?? ""}</td>
          <td class="money">${money(r.value)}</td>
        `;
        table.appendChild(tr);
      });

      statusEl.textContent = `Loaded ${data.rows.length} record(s).`;
    }

    function loadJSONP() {
      statusEl.textContent = "Loading...";

      const cbName = "cb_" + Math.random().toString(36).slice(2);
      window[cbName] = (payload) => {
        renderData(payload);
        delete window[cbName];
        script.remove();
      };

      const script = document.createElement("script");
      script.src = `${SCRIPT_URL}?callback=${cbName}`;
      script.onerror = () => {
        statusEl.textContent = "Error loading data (check SCRIPT_URL / deployment access).";
        delete window[cbName];
        script.remove();
      };
      document.body.appendChild(script);
    }

    loadJSONP();
  </script>
</body>
</html>
